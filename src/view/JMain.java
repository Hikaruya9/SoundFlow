/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package view;

import controller.MediaController;
import controller.TrackController;
import data.Track;
import java.awt.event.KeyEvent;
import java.awt.event.MouseEvent;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Iterator;
import javax.imageio.ImageIO;
import javax.swing.DefaultListModel;
import javax.swing.ImageIcon;
import javax.swing.JList;
import javax.swing.JOptionPane;
import javax.swing.ListModel;
import javax.swing.UIManager;
import javax.swing.table.DefaultTableModel;
import jmusic.JMusicPlayerList;
import jmusic.JMusicSong;
import jmusic.MusicPlayerControl;
import model.TrackDAO;

/**
 *
 * @author Aluno
 */
public class JMain extends javax.swing.JFrame {
    
    TrackController trackController;
    MediaController mediaController;
    private JMusicPlayerList musicList;

    /**
     * Creates new form JMain
     */
    public JMain(TrackController trackController, MediaController mediaController, JMusicPlayerList musicList) {
        this.trackController = trackController;
        this.mediaController = mediaController;
        this.musicList = musicList;
        initComponents();
        initMyOwnComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        pnlBackground = new javax.swing.JPanel();
        txtSearchTrack = new javax.swing.JTextField();
        pgrBarSong = new javax.swing.JProgressBar();
        btnPlay = new javax.swing.JButton();
        lblTrackImage = new javax.swing.JLabel();
        btnRepeat = new javax.swing.JButton();
        btnPrevious = new javax.swing.JButton();
        btnVolume = new javax.swing.JButton();
        btnNext = new javax.swing.JButton();
        btnShuffle = new javax.swing.JButton();
        sldVolume = new javax.swing.JSlider();
        jLayeredPane2 = new javax.swing.JLayeredPane();
        jScrollPane2 = new javax.swing.JScrollPane();
        listSongs = new javax.swing.JList<>();
        jScrollPane1 = new javax.swing.JScrollPane();
        listQueue = new javax.swing.JList<>();
        lblTotalSongTime = new javax.swing.JLabel();
        lblActualSongTime = new javax.swing.JLabel();
        btnDelete = new javax.swing.JButton();
        btnAdd = new javax.swing.JButton();
        btnUpdate = new javax.swing.JButton();
        lblCurrentSongTitle = new javax.swing.JLabel();
        lblCurrentSongArtist = new javax.swing.JLabel();
        btnClearQueue = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        pnlBackground.setBackground(new java.awt.Color(5, 5, 5));
        pnlBackground.setForeground(new java.awt.Color(255, 255, 255));
        pnlBackground.setLayout(null);

        txtSearchTrack.setBackground(new java.awt.Color(41, 40, 40));
        txtSearchTrack.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        txtSearchTrack.setForeground(new java.awt.Color(204, 204, 204));
        txtSearchTrack.setBorder(javax.swing.BorderFactory.createEmptyBorder(5, 20, 5, 5));
        txtSearchTrack.setSelectionColor(new java.awt.Color(153, 153, 153));
        txtSearchTrack.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtSearchTrackKeyPressed(evt);
            }
        });
        pnlBackground.add(txtSearchTrack);
        txtSearchTrack.setBounds(410, 20, 460, 40);

        pgrBarSong.setBackground(new java.awt.Color(30, 30, 30));
        pgrBarSong.setForeground(new java.awt.Color(255, 255, 255));
        pgrBarSong.setBorder(null);
        pgrBarSong.setFocusable(false);
        pgrBarSong.setString("10%");
        pnlBackground.add(pgrBarSong);
        pgrBarSong.setBounds(410, 695, 460, 7);

        btnPlay.setBackground(new java.awt.Color(255, 255, 255));
        btnPlay.setIcon(new javax.swing.ImageIcon(getClass().getResource("/play.png"))); // NOI18N
        btnPlay.setRequestFocusEnabled(false);
        btnPlay.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnPlayMouseClicked(evt);
            }
        });
        pnlBackground.add(btnPlay);
        btnPlay.setBounds(620, 645, 35, 35);
        pnlBackground.add(lblTrackImage);
        lblTrackImage.setBounds(20, 640, 60, 60);

        btnRepeat.setBackground(new java.awt.Color(5, 5, 5));
        btnRepeat.setIcon(new javax.swing.ImageIcon(getClass().getResource("/repeat.png"))); // NOI18N
        btnRepeat.setBorder(null);
        btnRepeat.setContentAreaFilled(false);
        btnRepeat.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnRepeatMouseClicked(evt);
            }
        });
        pnlBackground.add(btnRepeat);
        btnRepeat.setBounds(720, 650, 30, 28);

        btnPrevious.setBackground(new java.awt.Color(5, 5, 5));
        btnPrevious.setIcon(new javax.swing.ImageIcon(getClass().getResource("/previous.png"))); // NOI18N
        btnPrevious.setBorder(null);
        btnPrevious.setBorderPainted(false);
        btnPrevious.setContentAreaFilled(false);
        btnPrevious.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnPreviousMouseClicked(evt);
            }
        });
        pnlBackground.add(btnPrevious);
        btnPrevious.setBounds(570, 650, 30, 28);

        btnVolume.setBackground(new java.awt.Color(5, 5, 5));
        btnVolume.setIcon(new javax.swing.ImageIcon(getClass().getResource("/volume2.png"))); // NOI18N
        btnVolume.setBorder(null);
        btnVolume.setBorderPainted(false);
        btnVolume.setContentAreaFilled(false);
        btnVolume.setFocusPainted(false);
        btnVolume.setFocusable(false);
        pnlBackground.add(btnVolume);
        btnVolume.setBounds(1020, 660, 30, 28);

        btnNext.setBackground(new java.awt.Color(5, 5, 5));
        btnNext.setIcon(new javax.swing.ImageIcon(getClass().getResource("/next.png"))); // NOI18N
        btnNext.setBorder(null);
        btnNext.setBorderPainted(false);
        btnNext.setContentAreaFilled(false);
        btnNext.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnNextMouseClicked(evt);
            }
        });
        pnlBackground.add(btnNext);
        btnNext.setBounds(670, 650, 30, 28);

        btnShuffle.setBackground(new java.awt.Color(5, 5, 5));
        btnShuffle.setIcon(new javax.swing.ImageIcon(getClass().getResource("/shuffle.png"))); // NOI18N
        btnShuffle.setBorder(null);
        btnShuffle.setBorderPainted(false);
        btnShuffle.setContentAreaFilled(false);
        btnShuffle.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnShuffleMouseClicked(evt);
            }
        });
        pnlBackground.add(btnShuffle);
        btnShuffle.setBounds(520, 650, 30, 28);

        sldVolume.setFocusable(false);
        pnlBackground.add(sldVolume);
        sldVolume.setBounds(1050, 662, 200, 22);

        jScrollPane2.setBorder(javax.swing.BorderFactory.createEmptyBorder(1, 1, 1, 1));

        listSongs.setBackground(new java.awt.Color(51, 51, 51));
        listSongs.setBorder(javax.swing.BorderFactory.createEmptyBorder(3, 3, 3, 3));
        listSongs.setForeground(new java.awt.Color(255, 255, 255));
        listSongs.setFixedCellHeight(40);
        listSongs.setFocusable(false);
        listSongs.setRequestFocusEnabled(false);
        listSongs.setSelectionBackground(new java.awt.Color(204, 204, 204));
        listSongs.setSelectionForeground(new java.awt.Color(255, 255, 255));
        listSongs.setVerifyInputWhenFocusTarget(false);
        listSongs.addListSelectionListener(new javax.swing.event.ListSelectionListener() {
            public void valueChanged(javax.swing.event.ListSelectionEvent evt) {
                listSongsValueChanged(evt);
            }
        });
        jScrollPane2.setViewportView(listSongs);

        jScrollPane1.setBorder(javax.swing.BorderFactory.createEmptyBorder(1, 1, 1, 1));

        listQueue.setBackground(new java.awt.Color(36, 36, 36));
        listQueue.setBorder(javax.swing.BorderFactory.createEmptyBorder(3, 3, 3, 3));
        listQueue.setForeground(new java.awt.Color(255, 255, 255));
        listQueue.setFixedCellHeight(40);
        listQueue.setFocusable(false);
        listQueue.setSelectionBackground(new java.awt.Color(150, 150, 150));
        listQueue.setSelectionForeground(new java.awt.Color(192, 192, 255));
        listQueue.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                listQueueMouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(listQueue);

        jLayeredPane2.setLayer(jScrollPane2, javax.swing.JLayeredPane.DEFAULT_LAYER);
        jLayeredPane2.setLayer(jScrollPane1, javax.swing.JLayeredPane.DEFAULT_LAYER);

        javax.swing.GroupLayout jLayeredPane2Layout = new javax.swing.GroupLayout(jLayeredPane2);
        jLayeredPane2.setLayout(jLayeredPane2Layout);
        jLayeredPane2Layout.setHorizontalGroup(
            jLayeredPane2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jLayeredPane2Layout.createSequentialGroup()
                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 920, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 328, Short.MAX_VALUE)
                .addContainerGap())
        );
        jLayeredPane2Layout.setVerticalGroup(
            jLayeredPane2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jLayeredPane2Layout.createSequentialGroup()
                .addGroup(jLayeredPane2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jScrollPane1)
                    .addComponent(jScrollPane2, javax.swing.GroupLayout.DEFAULT_SIZE, 524, Short.MAX_VALUE))
                .addContainerGap())
        );

        pnlBackground.add(jLayeredPane2);
        jLayeredPane2.setBounds(10, 90, 1260, 530);

        lblTotalSongTime.setBackground(new java.awt.Color(5, 5, 5));
        lblTotalSongTime.setForeground(new java.awt.Color(140, 140, 140));
        lblTotalSongTime.setText("-:--");
        lblTotalSongTime.setFocusable(false);
        pnlBackground.add(lblTotalSongTime);
        lblTotalSongTime.setBounds(880, 690, 37, 16);

        lblActualSongTime.setBackground(new java.awt.Color(5, 5, 5));
        lblActualSongTime.setForeground(new java.awt.Color(140, 140, 140));
        lblActualSongTime.setText("-:--");
        lblActualSongTime.setFocusable(false);
        pnlBackground.add(lblActualSongTime);
        lblActualSongTime.setBounds(380, 690, 18, 16);

        btnDelete.setBackground(new java.awt.Color(50, 50, 50));
        btnDelete.setText("D");
        btnDelete.setFocusable(false);
        btnDelete.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnDeleteMouseClicked(evt);
            }
        });
        pnlBackground.add(btnDelete);
        btnDelete.setBounds(250, 27, 37, 27);

        btnAdd.setBackground(new java.awt.Color(50, 50, 50));
        btnAdd.setText("A");
        btnAdd.setFocusable(false);
        btnAdd.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnAddMouseClicked(evt);
            }
        });
        pnlBackground.add(btnAdd);
        btnAdd.setBounds(350, 27, 37, 27);

        btnUpdate.setBackground(new java.awt.Color(50, 50, 50));
        btnUpdate.setText("U");
        btnUpdate.setFocusable(false);
        btnUpdate.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnUpdateMouseClicked(evt);
            }
        });
        pnlBackground.add(btnUpdate);
        btnUpdate.setBounds(300, 27, 37, 27);

        lblCurrentSongTitle.setBackground(new java.awt.Color(5, 5, 5));
        lblCurrentSongTitle.setFont(new java.awt.Font("Segoe UI", 1, 13)); // NOI18N
        lblCurrentSongTitle.setForeground(new java.awt.Color(240, 240, 240));
        lblCurrentSongTitle.setText("music title");
        pnlBackground.add(lblCurrentSongTitle);
        lblCurrentSongTitle.setBounds(90, 646, 270, 16);

        lblCurrentSongArtist.setBackground(new java.awt.Color(5, 5, 5));
        lblCurrentSongArtist.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        lblCurrentSongArtist.setForeground(new java.awt.Color(240, 240, 240));
        lblCurrentSongArtist.setText("artist");
        pnlBackground.add(lblCurrentSongArtist);
        lblCurrentSongArtist.setBounds(90, 665, 270, 16);

        btnClearQueue.setBackground(new java.awt.Color(60, 60, 60));
        btnClearQueue.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        btnClearQueue.setForeground(new java.awt.Color(255, 255, 255));
        btnClearQueue.setText("CLEAR");
        btnClearQueue.setBorder(javax.swing.BorderFactory.createEmptyBorder(5, 5, 5, 5));
        btnClearQueue.setBorderPainted(false);
        btnClearQueue.setFocusPainted(false);
        btnClearQueue.setFocusable(false);
        btnClearQueue.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnClearQueueMouseClicked(evt);
            }
        });
        pnlBackground.add(btnClearQueue);
        btnClearQueue.setBounds(1010, 50, 180, 26);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(pnlBackground, javax.swing.GroupLayout.PREFERRED_SIZE, 1280, javax.swing.GroupLayout.PREFERRED_SIZE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(pnlBackground, javax.swing.GroupLayout.PREFERRED_SIZE, 720, javax.swing.GroupLayout.PREFERRED_SIZE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void txtSearchTrackKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtSearchTrackKeyPressed
       //Faz a pesquina no banco de dados pelo nome digitado ao pressionar ENTER
        if (evt.getKeyCode() == KeyEvent.VK_ENTER) {
            mediaController.insertSongIntoList(txtSearchTrack.getText());
        }
    }//GEN-LAST:event_txtSearchTrackKeyPressed

    private void btnNextMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnNextMouseClicked
        //Passa pra próxima música da lista atual
        mediaController.nextSong();
    }//GEN-LAST:event_btnNextMouseClicked

    private void btnPlayMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnPlayMouseClicked
        //Pausa-Inicia-Retorna a música e altera o icone do btnPlay
        mediaController.initMusicPlayer();
        mediaController.changeLogicButtons();
    }//GEN-LAST:event_btnPlayMouseClicked

    private void btnPreviousMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnPreviousMouseClicked
        //Retorna pra música anterior da lista atual
        mediaController.prevSong();
    }//GEN-LAST:event_btnPreviousMouseClicked

    private void btnShuffleMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnShuffleMouseClicked
        //Mistura a lista de músicas atual em ordem aleatória
        mediaController.shuffle();
    }//GEN-LAST:event_btnShuffleMouseClicked

    private void btnAddMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnAddMouseClicked
        //Abre uma janela para adicionar um valor ao banco de dados
        JAdd jadd = new JAdd(trackController);
        jadd.setLocationRelativeTo(jadd);
        jadd.setDefaultCloseOperation(DISPOSE_ON_CLOSE);
        jadd.setVisible(true);
    }//GEN-LAST:event_btnAddMouseClicked

    private void btnUpdateMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnUpdateMouseClicked
        // Abre uma janela para atualizar um valor ao banco de dados
        JUpdate jupdate = new JUpdate(trackController);
        jupdate.setLocationRelativeTo(jupdate);
        jupdate.setDefaultCloseOperation(DISPOSE_ON_CLOSE);
        jupdate.setVisible(true);
    }//GEN-LAST:event_btnUpdateMouseClicked

    private void btnDeleteMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnDeleteMouseClicked
        //Abre uma janela para remover um valor ao banco de dados
        JDelete jdelete = new JDelete(trackController);
        jdelete.setLocationRelativeTo(jdelete);
        jdelete.setDefaultCloseOperation(DISPOSE_ON_CLOSE);
        jdelete.setVisible(true);
    }//GEN-LAST:event_btnDeleteMouseClicked

    private void btnRepeatMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnRepeatMouseClicked
        //Repete a música atual
        mediaController.repeatSong();
    }//GEN-LAST:event_btnRepeatMouseClicked

    private void listSongsValueChanged(javax.swing.event.ListSelectionEvent evt) {//GEN-FIRST:event_listSongsValueChanged
        //Capta o valor do id atribuido ao valor da lista
        if (!evt.getValueIsAdjusting()) {
            Track selectedTrack = listSongs.getSelectedValue();
            if (selectedTrack != null) {
                mediaController.insertSongIntoPlayerList(selectedTrack.getId());
            }
        }
    }//GEN-LAST:event_listSongsValueChanged

    private void btnClearQueueMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnClearQueueMouseClicked
        //Limpa a lista atual
        mediaController.clearQueue();
        mediaController.clearPlayerList();
    }//GEN-LAST:event_btnClearQueueMouseClicked

    private void listQueueMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_listQueueMouseClicked
        // Registra quantos cliques foram feitos em um valor da lista
        JList list = (JList) evt.getSource();
        if (evt.getClickCount() == 2) {
            mediaController.initMusicPlayer();
            mediaController.changeSongFromIndex();
        }
    }//GEN-LAST:event_listQueueMouseClicked

    private void initMyOwnComponents() {
        //Inicializa/modifica componenetes extras que não cabem no principal
        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setResizable(false);
        mediaController.initOutlets(listSongs, listQueue, btnPlay, lblCurrentSongTitle, lblCurrentSongArtist, lblTotalSongTime, lblTrackImage, btnRepeat); //Inicializa as informações na interface trazidas do mediaController
    }

    /**
     * @param args the command line arguments
     */
//    boolean checkPlayPause = false;
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(JMain.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(JMain.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(JMain.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(JMain.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                TrackDAO trackDAO = new TrackDAO();
                TrackController trackController = new TrackController(trackDAO);

                JMusicPlayerList musicList = new JMusicPlayerList();
                MediaController mediaController = new MediaController(trackDAO,musicList);

                JMain jmain = new JMain(trackController, mediaController, musicList);
                jmain.setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnAdd;
    private javax.swing.JButton btnClearQueue;
    private javax.swing.JButton btnDelete;
    private javax.swing.JButton btnNext;
    private javax.swing.JButton btnPlay;
    private javax.swing.JButton btnPrevious;
    private javax.swing.JButton btnRepeat;
    private javax.swing.JButton btnShuffle;
    private javax.swing.JButton btnUpdate;
    private javax.swing.JButton btnVolume;
    private javax.swing.JLayeredPane jLayeredPane2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JLabel lblActualSongTime;
    private javax.swing.JLabel lblCurrentSongArtist;
    private javax.swing.JLabel lblCurrentSongTitle;
    private javax.swing.JLabel lblTotalSongTime;
    private javax.swing.JLabel lblTrackImage;
    private javax.swing.JList<String> listQueue;
    private javax.swing.JList<Track> listSongs;
    private javax.swing.JProgressBar pgrBarSong;
    private javax.swing.JPanel pnlBackground;
    private javax.swing.JSlider sldVolume;
    private javax.swing.JTextField txtSearchTrack;
    // End of variables declaration//GEN-END:variables
}
